<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ost√©oPro Ultimate - Tests Int√©gr√©s</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            background: linear-gradient(135deg, #0a0a14 0%, #16213e 100%);
            background-attachment: fixed;
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { max-width: 800px; margin: 0 auto; }
        
        h1 {
            text-align: center;
            font-size: clamp(32px, 8vw, 56px);
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #e94560 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            text-align: center;
            color: #7c8db5;
            margin-bottom: 40px;
            font-size: 14px;
        }
        
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.3s; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .btn-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
        }
        
        .btn-main {
            background: #16213e;
            border: 2px solid #e94560;
            color: white;
            padding: 30px 20px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        
        .btn-main:active {
            transform: scale(0.95);
            background: #e94560;
        }
        
        .icon { font-size: 40px; display: block; margin-bottom: 10px; }
        
        .btn-back {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 20px;
            border: none;
        }
        
        .form-section {
            background: #16213e;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .form-section h2 {
            color: #e94560;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .form-group { margin-bottom: 18px; }
        
        label {
            display: block;
            color: #7c8db5;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 14px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-family: inherit;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #e94560;
            background: rgba(255,255,255,0.12);
        }
        
        textarea { min-height: 80px; resize: vertical; }
        
        /* TESTS SP√âCIFIQUES */
        .tests-toggle {
            background: rgba(6, 214, 160, 0.15);
            border: 1px solid rgba(6, 214, 160, 0.3);
            color: #06d6a0;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            width: 100%;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tests-toggle:hover {
            background: rgba(6, 214, 160, 0.25);
        }
        
        .tests-panel {
            display: none;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
        }
        
        .tests-panel.open {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 500px;
            }
        }
        
        .test-item {
            background: rgba(255,255,255,0.05);
            border-left: 3px solid #06d6a0;
            padding: 10px 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .test-item:hover {
            background: rgba(6, 214, 160, 0.1);
            transform: translateX(4px);
        }
        
        .test-item strong {
            color: #06d6a0;
            display: block;
            font-size: 13px;
            margin-bottom: 4px;
        }
        
        .test-item span {
            color: #b8c1ec;
            font-size: 12px;
        }
        
        /* EVA SLIDER */
        .eva-container {
            background: rgba(255,255,255,0.05);
            padding: 24px;
            border-radius: 12px;
            margin-top: 12px;
        }
        
        .eva-display {
            text-align: center;
            font-size: 48px;
            font-weight: bold;
            color: #e94560;
            margin-bottom: 20px;
        }
        
        .eva-slider-container {
            position: relative;
            height: 60px;
        }
        
        .eva-scale {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 0 10px;
        }
        
        .eva-scale span {
            font-size: 12px;
            color: #7c8db5;
            width: 30px;
            text-align: center;
        }
        
        .eva-slider {
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: linear-gradient(90deg, 
                #06d6a0 0%, 
                #ffd166 25%, 
                #ef476f 50%,
                #e94560 75%,
                #8b0000 100%);
            outline: none;
            -webkit-appearance: none;
            position: relative;
        }
        
        .eva-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            border: 4px solid #e94560;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .eva-slider::-moz-range-thumb {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            border: 4px solid #e94560;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .eva-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            padding: 0 10px;
        }
        
        .eva-labels span {
            font-size: 11px;
            color: #7c8db5;
            text-align: center;
        }
        
        /* PLAINTES MULTIPLES */
        .plainte-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            position: relative;
        }
        
        .plainte-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .plainte-title {
            color: #e94560;
            font-weight: bold;
            font-size: 16px;
        }
        
        .btn-remove {
            background: rgba(233, 69, 96, 0.2);
            border: 1px solid #e94560;
            color: #e94560;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .btn-add {
            background: rgba(6, 214, 160, 0.2);
            border: 1px solid #06d6a0;
            color: #06d6a0;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 12px;
        }
        
        /* HISTORIQUE TRAITEMENTS */
        .traitement-item {
            background: rgba(255,255,255,0.05);
            border-left: 4px solid #06d6a0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .traitement-date {
            color: #06d6a0;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .traitement-content {
            color: #b8c1ec;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 10px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .checkbox-item label {
            margin: 0;
            text-transform: none;
            letter-spacing: normal;
            font-size: 14px;
            cursor: pointer;
        }
        
        .btn-save {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #e94560, #ff6b81);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .btn-save:active { transform: scale(0.98); }
        
        .bilan-card {
            background: #16213e;
            border: 1px solid rgba(255,255,255,0.1);
            border-left: 4px solid #e94560;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.2s;
        }
        
        .bilan-card:active {
            transform: translateX(4px);
            border-left-width: 8px;
        }
        
        .bilan-card h3 {
            color: #e94560;
            font-size: 20px;
            margin-bottom: 8px;
        }
        
        .bilan-meta {
            color: #7c8db5;
            font-size: 13px;
            margin-bottom: 12px;
        }
        
        .bilan-preview {
            color: #b8c1ec;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .btn-small {
            padding: 10px 18px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        .btn-danger {
            background: rgba(233, 69, 96, 0.2);
            border-color: #e94560;
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #7c8db5;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .detail-section {
            background: #16213e;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .detail-section h3 {
            color: #e94560;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .detail-field {
            margin-bottom: 12px;
        }
        
        .detail-label {
            color: #7c8db5;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        
        .detail-value {
            color: white;
            font-size: 16px;
        }
        
        .plaintes-list {
            margin-top: 12px;
        }
        
        .plainte-detail {
            background: rgba(255,255,255,0.05);
            border-left: 3px solid #e94560;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
        }
        
        .plainte-detail strong {
            color: #e94560;
            display: block;
            margin-bottom: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- √âCRAN ACCUEIL -->
        <div id="screenHome" class="screen active">
            <h1>Ost√©oPro</h1>
            <p class="subtitle">Version Ultimate avec Tests Int√©gr√©s</p>
            
            <div class="btn-grid">
                <button class="btn-main" id="btnNewBilan">
                    <span class="icon">‚ûï</span>
                    Nouveau Bilan
                </button>
                <button class="btn-main" id="btnListBilans">
                    <span class="icon">üìÅ</span>
                    Mes Bilans
                </button>
                <button class="btn-main" id="btnStats">
                    <span class="icon">üìä</span>
                    Statistiques
                </button>
                <button class="btn-main" id="btnExport">
                    <span class="icon">üíæ</span>
                    Exporter
                </button>
            </div>
            
            <div id="recentBilansHome"></div>
        </div>
        
        <!-- √âCRAN FORMULAIRE -->
        <div id="screenForm" class="screen">
            <button class="btn-back" id="btnBackFromForm">‚Üê Retour</button>
            
            <!-- 1. √âtat Civil -->
            <div class="form-section">
                <h2>1. √âtat Civil</h2>
                
                <div class="form-group">
                    <label>Nom et Pr√©nom *</label>
                    <input type="text" id="inputNom" placeholder="Ex: Jean Dupont">
                </div>
                
                <div class="form-group">
                    <label>Date de naissance / √Çge</label>
                    <input type="text" id="inputDateNaissance" placeholder="01/01/1985 ou 38 ans">
                </div>
                
                <div class="form-group">
                    <label>Profession</label>
                    <input type="text" id="inputProfession" placeholder="Ex: Informaticien">
                </div>
                
                <div class="form-group">
                    <label>Sport(s) pratiqu√©(s)</label>
                    <input type="text" id="inputSport" placeholder="Ex: Tennis 2x/sem, Course √† pied">
                </div>
                
                <div class="form-group">
                    <label>T√©l√©phone</label>
                    <input type="tel" id="inputTel" placeholder="06 12 34 56 78">
                </div>
            </div>
            
            <!-- 2. Histoire Personnelle et Mode de Vie -->
            <div class="form-section">
                <h2>2. Histoire Personnelle et Mode de Vie</h2>
                
                <div class="form-group">
                    <label>Environnement familial, social et √©motionnel</label>
                    <textarea id="inputHistoirePerso" placeholder="Situation familiale, contexte social, √©v√©nements √©motionnels marquants..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Activit√© professionnelle et ergonomie</label>
                    <textarea id="inputErgonomie" placeholder="Posture au travail, position assise prolong√©e, port de charges, gestes r√©p√©titifs..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Niveau de stress</label>
                    <select id="inputStress">
                        <option value="">-- S√©lectionner --</option>
                        <option value="Faible">Faible</option>
                        <option value="Mod√©r√©">Mod√©r√©</option>
                        <option value="√âlev√©">√âlev√©</option>
                        <option value="Tr√®s √©lev√©">Tr√®s √©lev√©</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Sources de stress identifi√©es</label>
                    <textarea id="inputSourcesStress" placeholder="Professionnel, familial, financier..."></textarea>
                </div>
            </div>
            
            <!-- 3. Plaintes Multiples avec EVA -->
            <div class="form-section">
                <h2>3. Plaintes / Motifs de Consultation</h2>
                
                <div id="plaintesContainer"></div>
                
                <button class="btn-add" id="btnAddPlainte">‚ûï Ajouter une plainte</button>
            </div>
            
            <!-- 4. Ant√©c√©dents -->
            <div class="form-section">
                <h2>4. Ant√©c√©dents</h2>
                
                <div class="form-group">
                    <label>Pathologies connues</label>
                    <textarea id="inputPathologies" placeholder="Maladies, troubles..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Ant√©c√©dents traumatiques</label>
                    <textarea id="inputTraumatiques" placeholder="Accidents, chutes..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Ant√©c√©dents chirurgicaux</label>
                    <textarea id="inputChirurgicaux" placeholder="Op√©rations, interventions chirurgicales (date et type)..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>M√©dicaments en cours</label>
                    <textarea id="inputMedicaments" placeholder="Liste des m√©dicaments..."></textarea>
                </div>
            </div>
            
            <!-- 5. Plaintes par Syst√®mes -->
            <div class="form-section">
                <h2>5. Plaintes par Syst√®mes</h2>
                
                <div style="background: rgba(138, 43, 226, 0.08); border: 1px solid rgba(138, 43, 226, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    
                    <div class="form-group">
                        <label style="color: #a78bfa;">üß† Sph√®re C√©phalique et ORL</label>
                        <textarea id="inputSystemeCephalique" placeholder="Maux de t√™te, migraines, c√©phal√©es, vertiges, acouph√®nes, troubles ORL, sinusites, probl√®mes visuels, probl√®mes dentaires..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #ef476f;">‚ù§Ô∏è Syst√®me Cardio-Vasculaire</label>
                        <textarea id="inputSystemeCardio" placeholder="Palpitations, douleurs thoraciques, essoufflement, troubles circulatoires, varices, ≈ìd√®mes..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #06d6a0;">ü´Å Syst√®me Respiratoire</label>
                        <textarea id="inputSystemeRespiratoire" placeholder="Dyspn√©e, asthme, toux chronique, oppression thoracique, troubles respiratoires..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #ffd166;">üçΩÔ∏è Syst√®me Digestif</label>
                        <textarea id="inputSystemeDigestif" placeholder="Douleurs abdominales, ballonnements, reflux, naus√©es, troubles digestifs, sensations de lourdeur..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #ff9f1c;">üí© Transit Intestinal</label>
                        <textarea id="inputSystemeTransit" placeholder="Constipation, diarrh√©e, alternance, troubles du transit, c√¥lon irritable..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #e94560;">ü©∫ Syst√®me Uro-G√©nital</label>
                        <textarea id="inputSystemeUro" placeholder="Troubles urinaires, incontinence, infections urinaires, douleurs pelviennes, troubles mictionnels..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #ff6b9d;">üå∏ Sph√®re Gyn√©cologique</label>
                        <textarea id="inputSystemeGyneco" placeholder="Troubles menstruels, dysm√©norrh√©e, syndrome pr√©menstruel, troubles de la fertilit√©, m√©nopause, douleurs pelviennes..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #b392ac;">üò¥ Troubles du Sommeil</label>
                        <textarea id="inputSystemeSommeil" placeholder="Insomnies, r√©veils nocturnes, sommeil non r√©parateur, apn√©es du sommeil, fatigue chronique..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #ffc6ff;">üßò Troubles Psycho-√âmotionnels</label>
                        <textarea id="inputSystemePsycho" placeholder="Stress, anxi√©t√©, √©tat d√©pressif, troubles de l'humeur, irritabilit√©, burn-out..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #8ecae6;">‚ö° Troubles Neurologiques</label>
                        <textarea id="inputSystemeNeuro" placeholder="Paresth√©sies, engourdissements, fourmillements, troubles de l'√©quilibre, troubles de la coordination..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #219ebc;">ü©∏ Troubles Vasculaires et Lymphatiques</label>
                        <textarea id="inputSystemeVasculaire" placeholder="Jambes lourdes, ≈ìd√®mes, troubles circulatoires, r√©tention d'eau, lymph≈ìd√®me..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #8d99ae;">üå°Ô∏è Autres Troubles</label>
                        <textarea id="inputSystemeAutres" placeholder="Troubles endocriniens, dermatologiques, allergies, faiblesse immunitaire, autres plaintes..."></textarea>
                    </div>
                    
                </div>
            </div>
            
            <!-- 6. Observation Posturale et Inspection -->
            <div class="form-section">
                <h2>6. Observation Posturale et Inspection</h2>
                
                <div style="background: rgba(255, 215, 0, 0.1); padding: 16px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #ffd166; font-size: 16px; margin-bottom: 12px;">üëÅÔ∏è Observation Globale</h3>
                    
                    <div class="form-group">
                        <label>Posture G√©n√©rale</label>
                        <textarea id="inputPostureGenerale" placeholder="Observation en position debout, assise, allong√©e..."></textarea>
                        <button class="tests-toggle" onclick="toggleTests('testsPosture')">
                            üîç Points d'observation posturale
                            <span>‚ñº</span>
                        </button>
                        <div id="testsPosture" class="tests-panel">
                            <div class="test-item" onclick="addTest('inputPostureGenerale', 'Position debout : ')">
                                <strong>Position debout</strong>
                                <span>Alignement g√©n√©ral, appuis plantaires</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputPostureGenerale', 'Position assise : ')">
                                <strong>Position assise</strong>
                                <span>Bascule bassin, courbures rachidiennes</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputPostureGenerale', 'Position allong√©e : ')">
                                <strong>Position allong√©e</strong>
                                <span>D√©cubitus dorsal/ventral</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Troubles Structurels</label>
                        <textarea id="inputTroublesStructurels" placeholder="Scoliose, hyperlordose, hypercyphose, bascule du bassin..."></textarea>
                        <button class="tests-toggle" onclick="toggleTests('testsTroubles')">
                            üîç Troubles structurels courants
                            <span>‚ñº</span>
                        </button>
                        <div id="testsTroubles" class="tests-panel">
                            <div class="test-item" onclick="addTest('inputTroublesStructurels', 'Scoliose : ')">
                                <strong>Scoliose</strong>
                                <span>D√©viation lat√©rale du rachis</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputTroublesStructurels', 'Hyperlordose lombaire : ')">
                                <strong>Hyperlordose lombaire</strong>
                                <span>Courbure lombaire accentu√©e</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputTroublesStructurels', 'Hypercyphose thoracique : ')">
                                <strong>Hypercyphose thoracique</strong>
                                <span>Courbure dorsale accentu√©e (dos rond)</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputTroublesStructurels', 'Bascule du bassin : ')">
                                <strong>Bascule du bassin</strong>
                                <span>Ant√©version/r√©troversion</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputTroublesStructurels', 'Attitude scoliotique : ')">
                                <strong>Attitude scoliotique</strong>
                                <span>D√©viation fonctionnelle r√©ductible</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Analyse de la Marche (Gait Analysis)</label>
                        <textarea id="inputMarche" placeholder="D√©marche, boiterie, d√©roul√© du pas, amplitude, compensations..."></textarea>
                        <button class="tests-toggle" onclick="toggleTests('testsMarche')">
                            üîç Points d'analyse de la marche
                            <span>‚ñº</span>
                        </button>
                        <div id="testsMarche" class="tests-panel">
                            <div class="test-item" onclick="addTest('inputMarche', 'Attaque du talon : ')">
                                <strong>Attaque du talon</strong>
                                <span>Phase d\'appui initial</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputMarche', 'D√©roul√© du pas : ')">
                                <strong>D√©roul√© du pas</strong>
                                <span>Talon-plante-orteils</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputMarche', 'Phase oscillante : ')">
                                <strong>Phase oscillante</strong>
                                <span>Balancement du membre</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputMarche', 'Boiterie : ')">
                                <strong>Boiterie</strong>
                                <span>Esquive douloureuse, compensation</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputMarche', 'Amplitude articulaire : ')">
                                <strong>Amplitude articulaire</strong>
                                <span>Hanche, genou, cheville</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputMarche', 'Balancement des bras : ')">
                                <strong>Balancement des bras</strong>
                                <span>Sym√©trie, amplitude</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Sym√©tries / Asym√©tries</label>
                        <textarea id="inputSymetries" placeholder="Rep√®res osseux : cr√™tes iliaques, √©pineuses, omoplates, √©paules, triangles de taille..."></textarea>
                        <button class="tests-toggle" onclick="toggleTests('testsSymetries')">
                            üîç Rep√®res anatomiques √† comparer
                            <span>‚ñº</span>
                        </button>
                        <div id="testsSymetries" class="tests-panel">
                            <div class="test-item" onclick="addTest('inputSymetries', 'Cr√™tes iliaques : ')">
                                <strong>Cr√™tes iliaques</strong>
                                <span>Hauteur D/G</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputSymetries', 'EIPS (√âpines iliaques post√©ro-sup√©rieures) : ')">
                                <strong>EIPS</strong>
                                <span>Position D/G</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputSymetries', '√âpineuses vert√©brales : ')">
                                <strong>√âpineuses vert√©brales</strong>
                                <span>Alignement, rotation</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputSymetries', 'Omoplates : ')">
                                <strong>Omoplates</strong>
                                <span>Hauteur, √©cartement D/G</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputSymetries', '√âpaules : ')">
                                <strong>√âpaules</strong>
                                <span>Hauteur, enroulement D/G</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputSymetries', 'Triangles de taille : ')">
                                <strong>Triangles de taille</strong>
                                <span>Espace bras-tronc D/G</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputSymetries', 'Plis sous-fessiers : ')">
                                <strong>Plis sous-fessiers</strong>
                                <span>Hauteur D/G</span>
                            </div>
                            <div class="test-item" onclick="addTest('inputSymetries', 'Longueur des membres : ')">
                                <strong>Longueur membres</strong>
                                <span>In√©galit√© apparente/r√©elle</span>
                            </div>
                </div>
            </div>
            
            <!-- 7. Bilan Ost√©o-Articulaire avec Tests -->
            <div class="form-section">
                <h2>7. Bilan Ost√©o-Articulaire par R√©gion</h2>
                
                <button class="guide-toggle" onclick="toggleGuide()" style="background: linear-gradient(135deg, rgba(138, 43, 226, 0.3), rgba(138, 43, 226, 0.15)); border: 2px solid rgba(138, 43, 226, 0.5); color: #a78bfa; padding: 16px 20px; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; margin-bottom: 20px; width: 100%; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                    üìö GUIDE DES L√âSIONS COURANTES (Cochez pour ajouter)
                    <span id="guideArrow">‚ñº</span>
                </button>
                
                <div id="guidePanel" class="guide-panel" style="display: none; background: rgba(138, 43, 226, 0.08); border: 1px solid rgba(138, 43, 226, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 25px;">
                    <div style="color: #a78bfa; line-height: 1.8; font-size: 13px;">
                        
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #a78bfa; font-size: 16px; margin-bottom: 12px;">ü¶µ PIEDS</h3>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Pieds', 'Talus ant√©rieur')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Talus ant√©rieur (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Pieds', 'Talus post√©rieur')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Talus post√©rieur (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Pieds', 'Calcan√©um interne')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Calcan√©um interne (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Pieds', 'Calcan√©um externe')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Calcan√©um externe (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Pieds', 'Cubo√Øde descendu')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Cubo√Øde descendu (D/G)</span></label>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #a78bfa; font-size: 16px; margin-bottom: 12px;">ü¶µ CHEVILLES</h3>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Chevilles', 'Fibula ant√©rieure')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Fibula ant√©rieure (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Chevilles', 'Fibula post√©rieure')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Fibula post√©rieure (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Chevilles', 'Torsion tibio-tarsienne')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Torsion tibio-tarsienne (D/G)</span></label>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #a78bfa; font-size: 16px; margin-bottom: 12px;">ü¶µ GENOUX</h3>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Genoux', 'Rotation tibiale interne')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Rotation tibiale interne (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Genoux', 'Rotation tibiale externe')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Rotation tibiale externe (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Genoux', 'F√©mur ant√©rieur')" style="margin-right: 8px; width: 18px; height: 18px;"><span>F√©mur ant√©rieur (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Genoux', 'F√©mur post√©rieur')" style="margin-right: 8px; width: 18px; height: 18px;"><span>F√©mur post√©rieur (D/G)</span></label>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #a78bfa; font-size: 16px; margin-bottom: 12px;">ü¶µ HANCHES</h3>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Hanches', 'Rotation ant√©rieure')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Rotation ant√©rieure (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Hanches', 'Rotation post√©rieure')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Rotation post√©rieure (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Hanches', 'Flexion')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Flexion (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Hanches', 'Extension')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Extension (D/G)</span></label>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #a78bfa; font-size: 16px; margin-bottom: 12px;">üîÑ BASSIN</h3>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Bassin', 'Iliaque ant√©rieur')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Iliaque ant√©rieur (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Bassin', 'Iliaque post√©rieur')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Iliaque post√©rieur (D/G)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Bassin', 'Sacrum torsion droite')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Sacrum torsion droite</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Bassin', 'Sacrum torsion gauche')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Sacrum torsion gauche</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Bassin', 'Upslip')" style="margin-right: 8px; width: 18px; height: 18px;"><span>Upslip (D/G)</span></label>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #a78bfa; font-size: 16px; margin-bottom: 12px;">üîÑ LOMBAIRES</h3>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Lombaires', 'FRS')" style="margin-right: 8px; width: 18px; height: 18px;"><span>FRS (pr√©ciser niveau)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Lombaires', 'ERS')" style="margin-right: 8px; width: 18px; height: 18px;"><span>ERS (pr√©ciser niveau)</span></label>
                            <label style="display: flex; align-items: center; padding: 6px; cursor: pointer; margin: 4px 0;"><input type="checkbox" onchange="updateLesions(this, 'Lombaires', 'NSR Type I')" style="margin-right: 8px; width: 18px; height: 18px;"><span>NSR Type I</span></label>
                        </div>
                        
                        <p style="color: #7c8db5; font-size: 12px; margin-top: 20px; font-style: italic;">üí° Cochez une l√©sion pour l'ajouter automatiquement au champ "Finding L√©sions" de la r√©gion correspondante</p>
                    </div>
                </div>
                
                <div style="background: rgba(6, 214, 160, 0.08); border: 2px solid rgba(6, 214, 160, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #06d6a0; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">ü¶µ Pieds</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobilitePieds" placeholder="Mobilit√© 1√®re MTP, vo√ªte plantaire, flexion/extension..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsPieds" placeholder="S√©lectionnez dans le guide ci-dessus ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                
                <div style="background: rgba(6, 214, 160, 0.08); border: 2px solid rgba(6, 214, 160, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #06d6a0; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">ü¶µ Chevilles</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteChevilles" placeholder="Tests de mobilit√©, amplitudes..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsChevilles" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                
                <div style="background: rgba(6, 214, 160, 0.08); border: 2px solid rgba(6, 214, 160, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #06d6a0; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">ü¶µ Genoux</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteGenoux" placeholder="Tests de mobilit√©, amplitudes..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsGenoux" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                
                <div style="background: rgba(6, 214, 160, 0.08); border: 2px solid rgba(6, 214, 160, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #06d6a0; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">ü¶µ Hanches</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteHanches" placeholder="Tests de mobilit√©, amplitudes..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsHanches" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                </div>
                </div>
                
                <div style="background: rgba(255, 209, 102, 0.08); border: 2px solid rgba(255, 209, 102, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #ffd166; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">üîÑ Bassin</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteBassin" placeholder="Tests de mobilit√©, amplitudes..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsBassin" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 209, 102, 0.08); border: 2px solid rgba(255, 209, 102, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #ffd166; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">üîÑ Rachis Lombaire (L1-L5)</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteLombaires" placeholder="Flexion/extension, rotation, tests segmentaires L1-L5..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsLombaires" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 209, 102, 0.08); border: 2px solid rgba(255, 209, 102, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #ffd166; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">üîÑ Rachis Dorsal (T1-T12)</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteDorsales" placeholder="Rotation, mobilit√© costale, tests segmentaires T1-T12..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsDorsales" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 209, 102, 0.08); border: 2px solid rgba(255, 209, 102, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #ffd166; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">üîÑ Rachis Cervical (C1-C7)</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteCervicales" placeholder="Rotation C1-C2, flexion/extension, tests segmentaires..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsCervicales" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(239, 71, 111, 0.08); border: 2px solid rgba(239, 71, 111, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #ef476f; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">üí™ Mains et Doigts</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteMains" placeholder="Tests de mobilit√©, amplitudes..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsMains" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                
                <div style="background: rgba(239, 71, 111, 0.08); border: 2px solid rgba(239, 71, 111, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #ef476f; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">üí™ Poignets</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobilitePoignets" placeholder="Tests de mobilit√©, amplitudes..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsPoignets" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                
                <div style="background: rgba(239, 71, 111, 0.08); border: 2px solid rgba(239, 71, 111, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #ef476f; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">üí™ Coudes</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteCoudes" placeholder="Tests de mobilit√©, amplitudes..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsCoudes" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                
                <div style="background: rgba(239, 71, 111, 0.08); border: 2px solid rgba(239, 71, 111, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #ef476f; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">üí™ √âpaules</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteEpaules" placeholder="Tests de mobilit√©, amplitudes..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsEpaules" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(167, 139, 250, 0.08); border: 2px solid rgba(167, 139, 250, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #a78bfa; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">üß† Cr√¢ne et Sph√®re Cr√¢nienne</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteCrane" placeholder="Tests de mobilit√©, amplitudes..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsCrane" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                
                <div style="background: rgba(167, 139, 250, 0.08); border: 2px solid rgba(167, 139, 250, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #a78bfa; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">ü´Å Thorax et Visc√®res</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteThorax" placeholder="Tests de mobilit√©, amplitudes..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsThorax" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                    </div>
                
                <div style="background: rgba(167, 139, 250, 0.08); border: 2px solid rgba(167, 139, 250, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #a78bfa; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">ü´Å Abdomen et Visc√®res</h3>
                        
                        <div class="form-group">
                            <label style="color: #06d6a0;">üü¢ Finding Mobilit√©</label>
                            <textarea id="inputMobiliteAbdomen" placeholder="Tests de mobilit√©, amplitudes..." style="background: rgba(6, 214, 160, 0.08); border-color: rgba(6, 214, 160, 0.3);"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #e94560;">üî¥ Finding L√©sions Ost√©opathiques</label>
                            <textarea id="inputLesionsAbdomen" placeholder="S√©lectionnez dans le guide ou tapez directement..." style="background: rgba(233, 69, 96, 0.08); border-color: rgba(233, 69, 96, 0.3);"></textarea>
                        </div>
                </div>
            
            <!-- 8. Diagnostic -->
            <div class="form-section">
                <h2>8. Diagnostic Ost√©opathique Global</h2>
                
                <div class="form-group">
                    <label>Dysfonctions principales identifi√©es</label>
                    <textarea id="inputDiagnostic" placeholder="Synth√®se des dysfonctions..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Lien avec les plaintes</label>
                    <textarea id="inputLienPlaintes" placeholder="Comment les dysfonctions expliquent les sympt√¥mes..."></textarea>
                </div>
            </div>
            
            <!-- 9. Traitement -->
            <div class="form-section">
                <h2>9. Traitement de cette s√©ance</h2>
                
                <div class="form-group">
                    <label>Date du traitement</label>
                    <input type="date" id="inputDateTraitement">
                </div>
                
                <div class="form-group">
                    <label>Techniques utilis√©es</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="cbStructurel">
                            <label for="cbStructurel">Structurel</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cbVisceral">
                            <label for="cbVisceral">Visc√©ral</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cbCranien">
                            <label for="cbCranien">Cr√¢nien</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cbFascial">
                            <label for="cbFascial">Fascial</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Description du traitement</label>
                    <textarea id="inputTraitement" placeholder="Zones trait√©es, techniques pr√©cises..."></textarea>
                </div>
            </div>
            
            <!-- 10. Conseils et Suivi -->
            <div class="form-section">
                <h2>10. Conseils et Suivi</h2>
                
                <div class="form-group">
                    <label>Conseils donn√©s</label>
                    <textarea id="inputConseils" placeholder="Repos, exercices, √©tirements..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Prochaine consultation</label>
                    <select id="inputProchaineConsult">
                        <option value="">-- S√©lectionner --</option>
                        <option value="1 semaine">1 semaine</option>
                        <option value="2 semaines">2 semaines</option>
                        <option value="3 semaines">3 semaines</option>
                        <option value="1 mois">1 mois</option>
                        <option value="Selon √©volution">Selon √©volution</option>
                    </select>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn-save" id="btnSaveBilan" style="flex: 1; min-width: 200px;">üíæ Enregistrer le Bilan</button>
                <button class="btn-save" id="btnExportBilan" style="flex: 1; min-width: 200px; background: linear-gradient(135deg, #06d6a0, #00b894);">üì§ T√©l√©charger pour OneDrive</button>
            </div>
            
            <div style="margin-top: 15px;">
                <input type="file" id="fileImportBilan" accept=".json" style="display: none;" onchange="importBilanFromFile(event)">
                <button class="btn-save" id="btnImportBilan" style="width: 100%; background: linear-gradient(135deg, #a78bfa, #8b5cf6);">üìÇ Charger un bilan depuis OneDrive</button>
            </div>
        </div>
        
        <!-- √âCRAN LISTE -->
        <div id="screenList" class="screen">
            <button class="btn-back" id="btnBackFromList">‚Üê Retour</button>
            <h2 style="margin-bottom: 30px; font-size: 32px;">Mes Bilans</h2>
            <div id="bilansList"></div>
        </div>
        
        <!-- √âCRAN D√âTAIL -->
        <div id="screenDetail" class="screen">
            <button class="btn-back" id="btnBackFromDetail">‚Üê Retour √† la liste</button>
            <div id="bilanDetailContent"></div>
            
            <!-- Ajout nouveau traitement -->
            <div class="form-section" style="margin-top: 30px;">
                <h2>‚ûï Ajouter un nouveau traitement</h2>
                
                <div class="form-group">
                    <label>Date du traitement</label>
                    <input type="date" id="inputNewTraitementDate">
                </div>
                
                <div class="form-group">
                    <label>Description du traitement</label>
                    <textarea id="inputNewTraitement" placeholder="Nouveau traitement effectu√©..."></textarea>
                </div>
                
                <button class="btn-save" id="btnAddTraitement">üíæ Ajouter ce traitement</button>
            </div>
        </div>
    </div>

    <script>
        // Donn√©es
        let bilans = [];
        let currentBilanId = null;
        let plaintesCount = 0;
        
        // Init
        function init() {
            const saved = localStorage.getItem('osteoproBilansUltimate');
            if (saved) {
                try {
                    bilans = JSON.parse(saved);
                } catch(e) {
                    bilans = [];
                }
            }
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('inputDateTraitement').value = today;
            
            updateHomeRecent();
            attachEventListeners();
            addPlainte();
        }
        
        // Event listeners
        function attachEventListeners() {
            document.getElementById('btnNewBilan').onclick = showFormScreen;
            document.getElementById('btnListBilans').onclick = showListScreen;
            document.getElementById('btnStats').onclick = showStatsAlert;
            document.getElementById('btnExport').onclick = exportAllBilans;
            
            document.getElementById('btnBackFromForm').onclick = showHomeScreen;
            document.getElementById('btnBackFromList').onclick = showHomeScreen;
            document.getElementById('btnBackFromDetail').onclick = showListScreen;
            
            document.getElementById('btnSaveBilan').onclick = saveBilan;
            document.getElementById('btnExportBilan').onclick = exportBilanToFile;
            document.getElementById('btnImportBilan').onclick = () => document.getElementById('fileImportBilan').click();
            document.getElementById('btnAddPlainte').onclick = addPlainte;
            document.getElementById('btnAddTraitement').onclick = addNewTraitement;
        }
        
        // Toggle tests panel
        function toggleTests(panelId) {
            const panel = document.getElementById(panelId);
            panel.classList.toggle('open');
        }
        
        // Ajouter un test au textarea
        function addTest(textareaId, testText) {
            const textarea = document.getElementById(textareaId);
            const currentValue = textarea.value;
            
            if (currentValue && !currentValue.endsWith('\n')) {
                textarea.value = currentValue + '\n' + testText;
            } else {
                textarea.value = currentValue + testText;
            }
            
            textarea.focus();
            textarea.setSelectionRange(textarea.value.length, textarea.value.length);
        }
        
        // Toggle guide panel
        function toggleGuide() {
            const panel = document.getElementById('guidePanel');
            const arrow = document.getElementById('guideArrow');
            if (panel.style.display === 'none' || !panel.style.display) {
                panel.style.display = 'block';
                arrow.textContent = '‚ñ≤';
            } else {
                panel.style.display = 'none';
                arrow.textContent = '‚ñº';
            }
        }
        
        // Update lesions from checkbox
        function updateLesions(checkbox, region, lesion) {
            const textareaId = 'inputLesions' + region.replace(/\s+/g, '');
            const textarea = document.getElementById(textareaId);
            
            if (!textarea) return;
            
            let currentValue = textarea.value;
            
            if (checkbox.checked) {
                // Ajouter la l√©sion
                if (currentValue && !currentValue.endsWith('\n')) {
                    currentValue += '\n';
                }
                currentValue += '‚Ä¢ ' + lesion;
                textarea.value = currentValue;
            } else {
                // Retirer la l√©sion
                const lines = currentValue.split('\n');
                const filteredLines = lines.filter(line => !line.includes(lesion));
                textarea.value = filteredLines.join('\n');
            }
        }
        
        // Navigation
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            window.scrollTo(0, 0);
        }
        
        function showHomeScreen() {
            showScreen('screenHome');
            updateHomeRecent();
        }
        
        function showFormScreen() {
            showScreen('screenForm');
            clearForm();
            plaintesCount = 0;
            document.getElementById('plaintesContainer').innerHTML = '';
            addPlainte();
        }
        
        function showListScreen() {
            showScreen('screenList');
            updateBilansList();
        }
        
        function showDetailScreen(id) {
            currentBilanId = id;
            showScreen('screenDetail');
            updateBilanDetail(id);
        }
        
        // Ajouter plainte (version simplifi√©e du code pr√©c√©dent - m√™me logique)
        function addPlainte() {
            plaintesCount++;
            const container = document.getElementById('plaintesContainer');
            const plainteId = 'plainte' + plaintesCount;
            
            const div = document.createElement('div');
            div.className = 'plainte-item';
            div.id = plainteId;
            
            if (plaintesCount === 1) {
                div.innerHTML = `
                    <div class="plainte-header">
                        <span class="plainte-title">Plainte Principale - Histoire de la Maladie (HDM)</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Motif de consultation *</label>
                        <input type="text" placeholder="Ex: Douleur lombaire gauche" data-field="motif">
                    </div>
                    
                    <div class="form-group">
                        <label>Intensit√© de la douleur (EVA)</label>
                        <div class="eva-container">
                            <div class="eva-display" data-display="eva">5/10</div>
                            <div class="eva-slider-container">
                                <div class="eva-scale">
                                    <span>0</span><span>1</span><span>2</span><span>3</span><span>4</span>
                                    <span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
                                </div>
                                <input type="range" min="0" max="10" value="5" class="eva-slider" data-field="eva" 
                                       oninput="updateEvaDisplay(this)">
                                <div class="eva-labels">
                                    <span>Pas de<br>douleur</span>
                                    <span>L√©g√®re</span>
                                    <span>Mod√©r√©e</span>
                                    <span>S√©v√®re</span>
                                    <span>Insupportable</span>
                                </div>
                </div>
                    
                    <div class="form-group">
                        <label>Date d'apparition</label>
                        <input type="text" placeholder="Ex: Il y a 2 semaines, le 15 janvier..." data-field="dateApparition">
                    </div>
                    
                    <div class="form-group">
                        <label>Circonstances de survenue</label>
                        <textarea placeholder="Comment est apparue la douleur ? (effort, mouvement, accident...)" data-field="circonstances"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>√âvolution / Fr√©quence</label>
                        <textarea placeholder="Comment √©volue la douleur ? Permanente, par crises..." data-field="evolution"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Facteurs aggravants</label>
                        <textarea placeholder="Ce qui empire la douleur (position, mouvement, moment de la journ√©e...)" data-field="aggravants"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Facteurs am√©liorants</label>
                        <textarea placeholder="Ce qui soulage (repos, chaleur, mouvement...)" data-field="ameliorants"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Localisation pr√©cise</label>
                        <input type="text" placeholder="Zone anatomique pr√©cise" data-field="localisation">
                    </div>
                    
                    <div class="form-group">
                        <label>Type de douleur</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="cbMecanique1" data-field="mecanique">
                                <label for="cbMecanique1">M√©canique</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="cbInflammatoire1" data-field="inflammatoire">
                                <label for="cbInflammatoire1">Inflammatoire</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="cbMixte1" data-field="mixte">
                                <label for="cbMixte1">Mixte</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="cbAigue1" data-field="aigue">
                                <label for="cbAigue1">Aigu√´</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="cbChronique1" data-field="chronique">
                                <label for="cbChronique1">Chronique</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Examens compl√©mentaires r√©alis√©s</label>
                        <textarea placeholder="Radio, IRM, scanner, √©chographie..." data-field="examens"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Traitements d√©j√† effectu√©s</label>
                        <textarea placeholder="M√©dicaments, kin√©sith√©rapie, ost√©opathie ant√©rieure..." data-field="traitementsAnterieurs"></textarea>
                    </div>
                `;
            } else {
                div.innerHTML = `
                    <div class="plainte-header">
                        <span class="plainte-title">Plainte #${plaintesCount - 1}</span>
                        <button class="btn-remove" onclick="removePlainte('${plainteId}')">‚úï</button>
                    </div>
                    <div class="form-group">
                        <label>Motif</label>
                        <input type="text" placeholder="Ex: Cervicalgie" data-field="motif">
                    </div>
                    <div class="form-group">
                        <label>EVA</label>
                        <div class="eva-container">
                            <div class="eva-display" data-display="eva">5/10</div>
                            <div class="eva-slider-container">
                                <div class="eva-scale">
                                    <span>0</span><span>1</span><span>2</span><span>3</span><span>4</span>
                                    <span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
                                </div>
                                <input type="range" min="0" max="10" value="5" class="eva-slider" data-field="eva" 
                                       oninput="updateEvaDisplay(this)">
                                <div class="eva-labels">
                                    <span>Aucune</span><span>L√©g√®re</span><span>Mod√©r√©e</span><span>S√©v√®re</span><span>Max</span>
                                </div>
                </div>
                `;
            }
            
            container.appendChild(div);
        }
        
        function updateEvaDisplay(slider) {
            const value = slider.value;
            const display = slider.closest('.plainte-item').querySelector('[data-display="eva"]');
            display.textContent = value + '/10';
            if (value <= 3) display.style.color = '#06d6a0';
            else if (value <= 6) display.style.color = '#ffd166';
            else display.style.color = '#e94560';
        }
        
        function removePlainte(id) {
            document.getElementById(id).remove();
        }
        
        function getAllPlaintes() {
            const plaintes = [];
            document.querySelectorAll('.plainte-item').forEach((item, index) => {
                const motif = item.querySelector('[data-field="motif"]').value;
                if (motif.trim()) {
                    const plainte = {
                        motif: motif,
                        eva: item.querySelector('[data-field="eva"]').value,
                        circonstances: item.querySelector('[data-field="circonstances"]') ? 
                            item.querySelector('[data-field="circonstances"]').value : '',
                        dateApparition: item.querySelector('[data-field="dateApparition"]') ? 
                            item.querySelector('[data-field="dateApparition"]').value : ''
                    };
                    
                    // Si c'est la premi√®re plainte, r√©cup√©rer tous les champs HDM
                    if (index === 0) {
                        plainte.evolution = item.querySelector('[data-field="evolution"]') ? 
                            item.querySelector('[data-field="evolution"]').value : '';
                        plainte.aggravants = item.querySelector('[data-field="aggravants"]') ? 
                            item.querySelector('[data-field="aggravants"]').value : '';
                        plainte.ameliorants = item.querySelector('[data-field="ameliorants"]') ? 
                            item.querySelector('[data-field="ameliorants"]').value : '';
                        plainte.localisation = item.querySelector('[data-field="localisation"]') ? 
                            item.querySelector('[data-field="localisation"]').value : '';
                        plainte.examens = item.querySelector('[data-field="examens"]') ? 
                            item.querySelector('[data-field="examens"]').value : '';
                        plainte.traitementsAnterieurs = item.querySelector('[data-field="traitementsAnterieurs"]') ? 
                            item.querySelector('[data-field="traitementsAnterieurs"]').value : '';
                        
                        // Type de douleur
                        plainte.typeDouleur = {
                            mecanique: item.querySelector('[data-field="mecanique"]') ? 
                                item.querySelector('[data-field="mecanique"]').checked : false,
                            inflammatoire: item.querySelector('[data-field="inflammatoire"]') ? 
                                item.querySelector('[data-field="inflammatoire"]').checked : false,
                            mixte: item.querySelector('[data-field="mixte"]') ? 
                                item.querySelector('[data-field="mixte"]').checked : false,
                            aigue: item.querySelector('[data-field="aigue"]') ? 
                                item.querySelector('[data-field="aigue"]').checked : false,
                            chronique: item.querySelector('[data-field="chronique"]') ? 
                                item.querySelector('[data-field="chronique"]').checked : false
                        };
                    }
                    
                    plaintes.push(plainte);
                }
            });
            return plaintes;
        }
        
        // Sauvegarder
        function saveBilan() {
            const nom = document.getElementById('inputNom').value.trim();
            const plaintes = getAllPlaintes();
            
            if (!nom || plaintes.length === 0) {
                alert('‚ö†Ô∏è Nom et au moins une plainte requis');
                return;
            }
            
            const techniques = [];
            if (document.getElementById('cbStructurel').checked) techniques.push('Structurel');
            if (document.getElementById('cbVisceral').checked) techniques.push('Visc√©ral');
            if (document.getElementById('cbCranien').checked) techniques.push('Cr√¢nien');
            if (document.getElementById('cbFascial').checked) techniques.push('Fascial');
            
            const bilan = {
                id: Date.now(),
                dateCreation: new Date().toISOString(),
                nom: nom,
                dateNaissance: document.getElementById('inputDateNaissance').value,
                profession: document.getElementById('inputProfession').value,
                sport: document.getElementById('inputSport').value,
                tel: document.getElementById('inputTel').value,
                
                // Histoire personnelle et mode de vie
                histoirePerso: document.getElementById('inputHistoirePerso').value,
                ergonomie: document.getElementById('inputErgonomie').value,
                stress: document.getElementById('inputStress').value,
                sourcesStress: document.getElementById('inputSourcesStress').value,
                
                // Observation posturale
                postureGenerale: document.getElementById('inputPostureGenerale').value,
                troublesStructurels: document.getElementById('inputTroublesStructurels').value,
                marche: document.getElementById('inputMarche').value,
                symetries: document.getElementById('inputSymetries').value,
                
                plaintes: plaintes,
                pathologies: document.getElementById('inputPathologies').value,
                traumatiques: document.getElementById('inputTraumatiques').value,
                chirurgicaux: document.getElementById('inputChirurgicaux').value,
                medicaments: document.getElementById('inputMedicaments').value,
                
                // Plaintes par syst√®mes
                systemeCephalique: document.getElementById('inputSystemeCephalique').value,
                systemeCardio: document.getElementById('inputSystemeCardio').value,
                systemeRespiratoire: document.getElementById('inputSystemeRespiratoire').value,
                systemeDigestif: document.getElementById('inputSystemeDigestif').value,
                systemeTransit: document.getElementById('inputSystemeTransit').value,
                systemeUro: document.getElementById('inputSystemeUro').value,
                systemeGyneco: document.getElementById('inputSystemeGyneco').value,
                systemeSommeil: document.getElementById('inputSystemeSommeil').value,
                systemePsycho: document.getElementById('inputSystemePsycho').value,
                systemeNeuro: document.getElementById('inputSystemeNeuro').value,
                systemeVasculaire: document.getElementById('inputSystemeVasculaire').value,
                systemeAutres: document.getElementById('inputSystemeAutres').value,
                
                bilanOsteo: {
                    mobilitePieds: document.getElementById('inputMobilitePieds').value,
                    lesionsPieds: document.getElementById('inputLesionsPieds').value,
                    mobiliteChevilles: document.getElementById('inputMobiliteChevilles').value,
                    lesionsChevilles: document.getElementById('inputLesionsChevilles').value,
                    mobiliteGenoux: document.getElementById('inputMobiliteGenoux').value,
                    lesionsGenoux: document.getElementById('inputLesionsGenoux').value,
                    mobiliteHanches: document.getElementById('inputMobiliteHanches').value,
                    lesionsHanches: document.getElementById('inputLesionsHanches').value,
                    mobiliteBassin: document.getElementById('inputMobiliteBassin').value,
                    lesionsBassin: document.getElementById('inputLesionsBassin').value,
                    mobiliteLombaires: document.getElementById('inputMobiliteLombaires').value,
                    lesionsLombaires: document.getElementById('inputLesionsLombaires').value,
                    mobiliteDorsales: document.getElementById('inputMobiliteDorsales').value,
                    lesionsDorsales: document.getElementById('inputLesionsDorsales').value,
                    mobiliteCervicales: document.getElementById('inputMobiliteCervicales').value,
                    lesionsCervicales: document.getElementById('inputLesionsCervicales').value,
                    mobiliteMains: document.getElementById('inputMobiliteMains').value,
                    lesionsMains: document.getElementById('inputLesionsMains').value,
                    mobilitePoignets: document.getElementById('inputMobilitePoignets').value,
                    lesionsPoignets: document.getElementById('inputLesionsPoignets').value,
                    mobiliteCoudes: document.getElementById('inputMobiliteCoudes').value,
                    lesionsCoudes: document.getElementById('inputLesionsCoudes').value,
                    mobiliteEpaules: document.getElementById('inputMobiliteEpaules').value,
                    lesionsEpaules: document.getElementById('inputLesionsEpaules').value,
                    mobiliteCrane: document.getElementById('inputMobiliteCrane').value,
                    lesionsCrane: document.getElementById('inputLesionsCrane').value,
                    mobiliteThorax: document.getElementById('inputMobiliteThorax').value,
                    lesionsThorax: document.getElementById('inputLesionsThorax').value,
                    mobiliteAbdomen: document.getElementById('inputMobiliteAbdomen').value,
                    lesionsAbdomen: document.getElementById('inputLesionsAbdomen').value
                },
                diagnostic: document.getElementById('inputDiagnostic').value,
                lienPlaintes: document.getElementById('inputLienPlaintes').value,
                traitements: [{
                    date: document.getElementById('inputDateTraitement').value,
                    techniques: techniques,
                    description: document.getElementById('inputTraitement').value
                }],
                conseils: document.getElementById('inputConseils').value,
                prochaineConsult: document.getElementById('inputProchaineConsult').value
            };
            
            bilans.unshift(bilan);
            saveToStorage();
            alert('‚úÖ Bilan enregistr√© !');
            showHomeScreen();
        }
        
        function addNewTraitement() {
            if (!currentBilanId) return;
            const date = document.getElementById('inputNewTraitementDate').value;
            const description = document.getElementById('inputNewTraitement').value.trim();
            
            if (!date || !description) {
                alert('‚ö†Ô∏è Date et description requis');
                return;
            }
            
            const bilan = bilans.find(b => b.id === currentBilanId);
            if (bilan) {
                if (!bilan.traitements) bilan.traitements = [];
                bilan.traitements.push({ date: date, description: description, techniques: [] });
                saveToStorage();
                alert('‚úÖ Traitement ajout√© !');
                document.getElementById('inputNewTraitement').value = '';
                document.getElementById('inputNewTraitementDate').value = new Date().toISOString().split('T')[0];
                updateBilanDetail(currentBilanId);
            }
        }
        
        function saveToStorage() {
            localStorage.setItem('osteoproBilansUltimate', JSON.stringify(bilans));
        }
        
        // EXPORT BILAN vers fichier JSON (pour OneDrive)
        function exportBilanToFile() {
            const nom = document.getElementById('inputNom').value.trim();
            const plaintes = getAllPlaintes();
            
            if (!nom || plaintes.length === 0) {
                alert('‚ö†Ô∏è Veuillez remplir au moins le nom et une plainte avant d\'exporter');
                return;
            }
            
            const techniques = [];
            if (document.getElementById('cbStructurel').checked) techniques.push('Structurel');
            if (document.getElementById('cbVisceral').checked) techniques.push('Visc√©ral');
            if (document.getElementById('cbCranien').checked) techniques.push('Cr√¢nien');
            if (document.getElementById('cbFascial').checked) techniques.push('Fascial');
            
            const bilan = {
                id: Date.now(),
                dateCreation: new Date().toISOString(),
                nom: nom,
                dateNaissance: document.getElementById('inputDateNaissance').value,
                profession: document.getElementById('inputProfession').value,
                sport: document.getElementById('inputSport').value,
                tel: document.getElementById('inputTel').value,
                
                histoirePerso: document.getElementById('inputHistoirePerso').value,
                ergonomie: document.getElementById('inputErgonomie').value,
                stress: document.getElementById('inputStress').value,
                sourcesStress: document.getElementById('inputSourcesStress').value,
                
                postureGenerale: document.getElementById('inputPostureGenerale').value,
                troublesStructurels: document.getElementById('inputTroublesStructurels').value,
                marche: document.getElementById('inputMarche').value,
                symetries: document.getElementById('inputSymetries').value,
                
                plaintes: plaintes,
                pathologies: document.getElementById('inputPathologies').value,
                traumatiques: document.getElementById('inputTraumatiques').value,
                chirurgicaux: document.getElementById('inputChirurgicaux').value,
                medicaments: document.getElementById('inputMedicaments').value,
                
                systemeCephalique: document.getElementById('inputSystemeCephalique').value,
                systemeCardio: document.getElementById('inputSystemeCardio').value,
                systemeRespiratoire: document.getElementById('inputSystemeRespiratoire').value,
                systemeDigestif: document.getElementById('inputSystemeDigestif').value,
                systemeTransit: document.getElementById('inputSystemeTransit').value,
                systemeUro: document.getElementById('inputSystemeUro').value,
                systemeGyneco: document.getElementById('inputSystemeGyneco').value,
                systemeSommeil: document.getElementById('inputSystemeSommeil').value,
                systemePsycho: document.getElementById('inputSystemePsycho').value,
                systemeNeuro: document.getElementById('inputSystemeNeuro').value,
                systemeVasculaire: document.getElementById('inputSystemeVasculaire').value,
                systemeAutres: document.getElementById('inputSystemeAutres').value,
                
                bilanOsteo: {
                    mobilitePieds: document.getElementById('inputMobilitePieds').value,
                    lesionsPieds: document.getElementById('inputLesionsPieds').value,
                    mobiliteChevilles: document.getElementById('inputMobiliteChevilles').value,
                    lesionsChevilles: document.getElementById('inputLesionsChevilles').value,
                    mobiliteGenoux: document.getElementById('inputMobiliteGenoux').value,
                    lesionsGenoux: document.getElementById('inputLesionsGenoux').value,
                    mobiliteHanches: document.getElementById('inputMobiliteHanches').value,
                    lesionsHanches: document.getElementById('inputLesionsHanches').value,
                    mobiliteBassin: document.getElementById('inputMobiliteBassin').value,
                    lesionsBassin: document.getElementById('inputLesionsBassin').value,
                    mobiliteLombaires: document.getElementById('inputMobiliteLombaires').value,
                    lesionsLombaires: document.getElementById('inputLesionsLombaires').value,
                    mobiliteDorsales: document.getElementById('inputMobiliteDorsales').value,
                    lesionsDorsales: document.getElementById('inputLesionsDorsales').value,
                    mobiliteCervicales: document.getElementById('inputMobiliteCervicales').value,
                    lesionsCervicales: document.getElementById('inputLesionsCervicales').value,
                    mobiliteMains: document.getElementById('inputMobiliteMains').value,
                    lesionsMains: document.getElementById('inputLesionsMains').value,
                    mobilitePoignets: document.getElementById('inputMobilitePoignets').value,
                    lesionsPoignets: document.getElementById('inputLesionsPoignets').value,
                    mobiliteCoudes: document.getElementById('inputMobiliteCoudes').value,
                    lesionsCoudes: document.getElementById('inputLesionsCoudes').value,
                    mobiliteEpaules: document.getElementById('inputMobiliteEpaules').value,
                    lesionsEpaules: document.getElementById('inputLesionsEpaules').value,
                    mobiliteCrane: document.getElementById('inputMobiliteCrane').value,
                    lesionsCrane: document.getElementById('inputLesionsCrane').value,
                    mobiliteThorax: document.getElementById('inputMobiliteThorax').value,
                    lesionsThorax: document.getElementById('inputLesionsThorax').value,
                    mobiliteAbdomen: document.getElementById('inputMobiliteAbdomen').value,
                    lesionsAbdomen: document.getElementById('inputLesionsAbdomen').value
                },
                diagnostic: document.getElementById('inputDiagnostic').value,
                lienPlaintes: document.getElementById('inputLienPlaintes').value,
                traitements: [{
                    date: new Date().toISOString().split('T')[0],
                    techniques: techniques,
                    description: document.getElementById('inputTraitement').value
                }],
                conseils: document.getElementById('inputConseils').value,
                prochaineConsult: document.getElementById('inputProchaineConsult').value
            };
            
            // Cr√©er le fichier JSON
            const jsonStr = JSON.stringify(bilan, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // Cr√©er un nom de fichier avec date et nom patient
            const date = new Date().toISOString().split('T')[0];
            const nomFichier = `OsteoPro_${nom.replace(/\s+/g, '_')}_${date}.json`;
            
            // T√©l√©charger
            const a = document.createElement('a');
            a.href = url;
            a.download = nomFichier;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert(`‚úÖ Bilan export√© !\n\nüìÅ Fichier: ${nomFichier}\n\nüí° Sauvegardez-le sur OneDrive pour le retrouver lors de la prochaine consultation.`);
        }
        
        // IMPORT BILAN depuis fichier JSON (depuis OneDrive)
        function importBilanFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const bilan = JSON.parse(e.target.result);
                    
                    // Confirmer l'import
                    if (!confirm(`üìÇ Charger le bilan de :\n\nüë§ ${bilan.nom}\nüìÖ ${new Date(bilan.dateCreation).toLocaleDateString('fr-FR')}\n\n‚úÖ Le formulaire sera pr√©-rempli avec ces donn√©es.`)) {
                        return;
                    }
                    
                    // Remplir le formulaire
                    fillFormFromBilan(bilan);
                    
                    alert('‚úÖ Bilan charg√© !\n\nVous pouvez maintenant modifier et ajouter de nouvelles informations.');
                    
                } catch (error) {
                    alert('‚ùå Erreur lors de la lecture du fichier.\n\nAssurez-vous qu\'il s\'agit bien d\'un fichier Ost√©oPro export√©.');
                    console.error(error);
                }
            };
            reader.readAsText(file);
            
            // Reset l'input pour pouvoir recharger le m√™me fichier
            event.target.value = '';
        }
        
        // Remplir le formulaire avec les donn√©es d'un bilan
        function fillFormFromBilan(bilan) {
            // √âtat civil
            document.getElementById('inputNom').value = bilan.nom || '';
            document.getElementById('inputDateNaissance').value = bilan.dateNaissance || '';
            document.getElementById('inputProfession').value = bilan.profession || '';
            document.getElementById('inputSport').value = bilan.sport || '';
            document.getElementById('inputTel').value = bilan.tel || '';
            
            // Histoire personnelle
            document.getElementById('inputHistoirePerso').value = bilan.histoirePerso || '';
            document.getElementById('inputErgonomie').value = bilan.ergonomie || '';
            document.getElementById('inputStress').value = bilan.stress || '';
            document.getElementById('inputSourcesStress').value = bilan.sourcesStress || '';
            
            // Observation posturale
            document.getElementById('inputPostureGenerale').value = bilan.postureGenerale || '';
            document.getElementById('inputTroublesStructurels').value = bilan.troublesStructurels || '';
            document.getElementById('inputMarche').value = bilan.marche || '';
            document.getElementById('inputSymetries').value = bilan.symetries || '';
            
            // Plaintes - Recr√©er les plaintes
            document.getElementById('plaintesContainer').innerHTML = '';
            if (bilan.plaintes && bilan.plaintes.length > 0) {
                bilan.plaintes.forEach((p, index) => {
                    addPlainte();
                    const items = document.querySelectorAll('.plainte-item');
                    const item = items[items.length - 1];
                    
                    item.querySelector('[data-field="motif"]').value = p.motif || '';
                    item.querySelector('[data-field="eva"]').value = p.eva || 5;
                    updateEvaDisplay(item.querySelector('[data-field="eva"]'));
                    
                    if (item.querySelector('[data-field="circonstances"]')) {
                        item.querySelector('[data-field="circonstances"]').value = p.circonstances || '';
                    }
                    if (item.querySelector('[data-field="dateApparition"]')) {
                        item.querySelector('[data-field="dateApparition"]').value = p.dateApparition || '';
                    }
                    
                    // Champs HDM suppl√©mentaires pour la premi√®re plainte
                    if (index === 0 && p.evolution) {
                        if (item.querySelector('[data-field="evolution"]')) {
                            item.querySelector('[data-field="evolution"]').value = p.evolution || '';
                        }
                        if (item.querySelector('[data-field="aggravants"]')) {
                            item.querySelector('[data-field="aggravants"]').value = p.aggravants || '';
                        }
                        if (item.querySelector('[data-field="ameliorants"]')) {
                            item.querySelector('[data-field="ameliorants"]').value = p.ameliorants || '';
                        }
                        if (item.querySelector('[data-field="localisation"]')) {
                            item.querySelector('[data-field="localisation"]').value = p.localisation || '';
                        }
                        if (item.querySelector('[data-field="examens"]')) {
                            item.querySelector('[data-field="examens"]').value = p.examens || '';
                        }
                        if (item.querySelector('[data-field="traitementsAnterieurs"]')) {
                            item.querySelector('[data-field="traitementsAnterieurs"]').value = p.traitementsAnterieurs || '';
                        }
                        
                        // Type de douleur
                        if (p.typeDouleur) {
                            if (item.querySelector('[data-field="mecanique"]')) item.querySelector('[data-field="mecanique"]').checked = p.typeDouleur.mecanique || false;
                            if (item.querySelector('[data-field="inflammatoire"]')) item.querySelector('[data-field="inflammatoire"]').checked = p.typeDouleur.inflammatoire || false;
                            if (item.querySelector('[data-field="mixte"]')) item.querySelector('[data-field="mixte"]').checked = p.typeDouleur.mixte || false;
                            if (item.querySelector('[data-field="aigue"]')) item.querySelector('[data-field="aigue"]').checked = p.typeDouleur.aigue || false;
                            if (item.querySelector('[data-field="chronique"]')) item.querySelector('[data-field="chronique"]').checked = p.typeDouleur.chronique || false;
                        }
                    }
                });
            } else {
                addPlainte(); // Au moins une plainte par d√©faut
            }
            
            // Ant√©c√©dents
            document.getElementById('inputPathologies').value = bilan.pathologies || '';
            document.getElementById('inputTraumatiques').value = bilan.traumatiques || '';
            document.getElementById('inputChirurgicaux').value = bilan.chirurgicaux || '';
            document.getElementById('inputMedicaments').value = bilan.medicaments || '';
            
            // Plaintes par syst√®mes
            document.getElementById('inputSystemeCephalique').value = bilan.systemeCephalique || '';
            document.getElementById('inputSystemeCardio').value = bilan.systemeCardio || '';
            document.getElementById('inputSystemeRespiratoire').value = bilan.systemeRespiratoire || '';
            document.getElementById('inputSystemeDigestif').value = bilan.systemeDigestif || '';
            document.getElementById('inputSystemeTransit').value = bilan.systemeTransit || '';
            document.getElementById('inputSystemeUro').value = bilan.systemeUro || '';
            document.getElementById('inputSystemeGyneco').value = bilan.systemeGyneco || '';
            document.getElementById('inputSystemeSommeil').value = bilan.systemeSommeil || '';
            document.getElementById('inputSystemePsycho').value = bilan.systemePsycho || '';
            document.getElementById('inputSystemeNeuro').value = bilan.systemeNeuro || '';
            document.getElementById('inputSystemeVasculaire').value = bilan.systemeVasculaire || '';
            document.getElementById('inputSystemeAutres').value = bilan.systemeAutres || '';
            
            // Bilan ost√©o
            if (bilan.bilanOsteo) {
                document.getElementById('inputMobilitePieds').value = bilan.bilanOsteo.mobilitePieds || '';
                document.getElementById('inputLesionsPieds').value = bilan.bilanOsteo.lesionsPieds || '';
                document.getElementById('inputMobiliteChevilles').value = bilan.bilanOsteo.mobiliteChevilles || '';
                document.getElementById('inputLesionsChevilles').value = bilan.bilanOsteo.lesionsChevilles || '';
                document.getElementById('inputMobiliteGenoux').value = bilan.bilanOsteo.mobiliteGenoux || '';
                document.getElementById('inputLesionsGenoux').value = bilan.bilanOsteo.lesionsGenoux || '';
                document.getElementById('inputMobiliteHanches').value = bilan.bilanOsteo.mobiliteHanches || '';
                document.getElementById('inputLesionsHanches').value = bilan.bilanOsteo.lesionsHanches || '';
                document.getElementById('inputMobiliteBassin').value = bilan.bilanOsteo.mobiliteBassin || '';
                document.getElementById('inputLesionsBassin').value = bilan.bilanOsteo.lesionsBassin || '';
                document.getElementById('inputMobiliteLombaires').value = bilan.bilanOsteo.mobiliteLombaires || '';
                document.getElementById('inputLesionsLombaires').value = bilan.bilanOsteo.lesionsLombaires || '';
                document.getElementById('inputMobiliteDorsales').value = bilan.bilanOsteo.mobiliteDorsales || '';
                document.getElementById('inputLesionsDorsales').value = bilan.bilanOsteo.lesionsDorsales || '';
                document.getElementById('inputMobiliteCervicales').value = bilan.bilanOsteo.mobiliteCervicales || '';
                document.getElementById('inputLesionsCervicales').value = bilan.bilanOsteo.lesionsCervicales || '';
                document.getElementById('inputMobiliteMains').value = bilan.bilanOsteo.mobiliteMains || '';
                document.getElementById('inputLesionsMains').value = bilan.bilanOsteo.lesionsMains || '';
                document.getElementById('inputMobilitePoignets').value = bilan.bilanOsteo.mobilitePoignets || '';
                document.getElementById('inputLesionsPoignets').value = bilan.bilanOsteo.lesionsPoignets || '';
                document.getElementById('inputMobiliteCoudes').value = bilan.bilanOsteo.mobiliteCoudes || '';
                document.getElementById('inputLesionsCoudes').value = bilan.bilanOsteo.lesionsCoudes || '';
                document.getElementById('inputMobiliteEpaules').value = bilan.bilanOsteo.mobiliteEpaules || '';
                document.getElementById('inputLesionsEpaules').value = bilan.bilanOsteo.lesionsEpaules || '';
                document.getElementById('inputMobiliteCrane').value = bilan.bilanOsteo.mobiliteCrane || '';
                document.getElementById('inputLesionsCrane').value = bilan.bilanOsteo.lesionsCrane || '';
                document.getElementById('inputMobiliteThorax').value = bilan.bilanOsteo.mobiliteThorax || '';
                document.getElementById('inputLesionsThorax').value = bilan.bilanOsteo.lesionsThorax || '';
                document.getElementById('inputMobiliteAbdomen').value = bilan.bilanOsteo.mobiliteAbdomen || '';
                document.getElementById('inputLesionsAbdomen').value = bilan.bilanOsteo.lesionsAbdomen || '';
            }
            
            // Diagnostic
            document.getElementById('inputDiagnostic').value = bilan.diagnostic || '';
            document.getElementById('inputLienPlaintes').value = bilan.lienPlaintes || '';
            
            // Traitement - Prendre le dernier traitement
            if (bilan.traitements && bilan.traitements.length > 0) {
                const dernierTraitement = bilan.traitements[bilan.traitements.length - 1];
                document.getElementById('inputTraitement').value = dernierTraitement.description || '';
                
                // Cocher les techniques
                document.getElementById('cbStructurel').checked = dernierTraitement.techniques.includes('Structurel');
                document.getElementById('cbVisceral').checked = dernierTraitement.techniques.includes('Visc√©ral');
                document.getElementById('cbCranien').checked = dernierTraitement.techniques.includes('Cr√¢nien');
                document.getElementById('cbFascial').checked = dernierTraitement.techniques.includes('Fascial');
            }
            
            // Conseils
            document.getElementById('inputConseils').value = bilan.conseils || '';
            document.getElementById('inputProchaineConsult').value = bilan.prochaineConsult || '';
        }
        
        
        function clearForm() {
            document.getElementById('inputNom').value = '';
            document.getElementById('inputDateNaissance').value = '';
            document.getElementById('inputProfession').value = '';
            document.getElementById('inputSport').value = '';
            document.getElementById('inputTel').value = '';
            
            // Histoire et mode de vie
            document.getElementById('inputHistoirePerso').value = '';
            document.getElementById('inputErgonomie').value = '';
            document.getElementById('inputStress').value = '';
            document.getElementById('inputSourcesStress').value = '';
            
            // Observation posturale
            document.getElementById('inputPostureGenerale').value = '';
            document.getElementById('inputTroublesStructurels').value = '';
            document.getElementById('inputMarche').value = '';
            document.getElementById('inputSymetries').value = '';
            
            document.getElementById('inputPathologies').value = '';
            document.getElementById('inputTraumatiques').value = '';
            document.getElementById('inputChirurgicaux').value = '';
            document.getElementById('inputMedicaments').value = '';
            
            // Plaintes par syst√®mes
            document.getElementById('inputSystemeCephalique').value = '';
            document.getElementById('inputSystemeCardio').value = '';
            document.getElementById('inputSystemeRespiratoire').value = '';
            document.getElementById('inputSystemeDigestif').value = '';
            document.getElementById('inputSystemeTransit').value = '';
            document.getElementById('inputSystemeUro').value = '';
            document.getElementById('inputSystemeGyneco').value = '';
            document.getElementById('inputSystemeSommeil').value = '';
            document.getElementById('inputSystemePsycho').value = '';
            document.getElementById('inputSystemeNeuro').value = '';
            document.getElementById('inputSystemeVasculaire').value = '';
            document.getElementById('inputSystemeAutres').value = '';
            
            // Bilan ost√©o-articulaire
            document.getElementById('inputMobilitePieds').value = '';
            document.getElementById('inputLesionsPieds').value = '';
            document.getElementById('inputMobiliteChevilles').value = '';
            document.getElementById('inputLesionsChevilles').value = '';
            document.getElementById('inputMobiliteGenoux').value = '';
            document.getElementById('inputLesionsGenoux').value = '';
            document.getElementById('inputMobiliteHanches').value = '';
            document.getElementById('inputLesionsHanches').value = '';
            document.getElementById('inputMobiliteBassin').value = '';
            document.getElementById('inputLesionsBassin').value = '';
            document.getElementById('inputMobiliteLombaires').value = '';
            document.getElementById('inputLesionsLombaires').value = '';
            document.getElementById('inputMobiliteDorsales').value = '';
            document.getElementById('inputLesionsDorsales').value = '';
            document.getElementById('inputMobiliteCervicales').value = '';
            document.getElementById('inputLesionsCervicales').value = '';
            document.getElementById('inputMobiliteMains').value = '';
            document.getElementById('inputLesionsMains').value = '';
            document.getElementById('inputMobilitePoignets').value = '';
            document.getElementById('inputLesionsPoignets').value = '';
            document.getElementById('inputMobiliteCoudes').value = '';
            document.getElementById('inputLesionsCoudes').value = '';
            document.getElementById('inputMobiliteEpaules').value = '';
            document.getElementById('inputLesionsEpaules').value = '';
            document.getElementById('inputMobiliteCrane').value = '';
            document.getElementById('inputLesionsCrane').value = '';
            document.getElementById('inputMobiliteThorax').value = '';
            document.getElementById('inputLesionsThorax').value = '';
            document.getElementById('inputMobiliteAbdomen').value = '';
            document.getElementById('inputLesionsAbdomen').value = '';
            
            // Diagnostic
            document.getElementById('inputDiagnostic').value = '';
            document.getElementById('inputLienPlaintes').value = '';
            document.getElementById('inputTraitement').value = '';
            document.getElementById('inputConseils').value = '';
            document.getElementById('inputProchaineConsult').value = '';
            document.getElementById('cbStructurel').checked = false;
            document.getElementById('cbVisceral').checked = false;
            document.getElementById('cbCranien').checked = false;
            document.getElementById('cbFascial').checked = false;
        }
        
        function updateHomeRecent() {
            const container = document.getElementById('recentBilansHome');
            if (bilans.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üìã</div><h3>Aucun bilan</h3></div>';
                return;
            }
            let html = '<h2 style="margin-bottom: 20px; font-size: 24px;">Bilans r√©cents</h2>';
            bilans.slice(0, 3).forEach(b => {
                const date = new Date(b.dateCreation).toLocaleDateString('fr-FR');
                const premierePlainte = b.plaintes && b.plaintes[0] ? b.plaintes[0].motif : 'Consultation';
                html += `<div class="bilan-card" onclick="showDetailScreen(${b.id})">
                    <h3>${b.nom}</h3>
                    <div class="bilan-meta">üìÖ ${date}</div>
                    <div class="bilan-preview">${premierePlainte}</div>
                </div>`;
            });
            container.innerHTML = html;
        }
        
        function updateBilansList() {
            const container = document.getElementById('bilansList');
            if (bilans.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üìÅ</div><h3>Aucun bilan</h3></div>';
                return;
            }
            let html = '';
            bilans.forEach(b => {
                const date = new Date(b.dateCreation).toLocaleDateString('fr-FR');
                const premierePlainte = b.plaintes && b.plaintes[0] ? b.plaintes[0].motif : 'Consultation';
                html += `<div class="bilan-card">
                    <h3>${b.nom}</h3>
                    <div class="bilan-meta">üìÖ ${date}</div>
                    <div class="bilan-preview">${premierePlainte}</div>
                    <button class="btn-small" onclick="showDetailScreen(${b.id})">üëÅÔ∏è Voir</button>
                    <button class="btn-small" onclick="shareBilan(${b.id})">üì§ Partager</button>
                    <button class="btn-small btn-danger" onclick="deleteBilan(${b.id})">üóëÔ∏è Supprimer</button>
                </div>`;
            });
            container.innerHTML = html;
        }
        
        function updateBilanDetail(id) {
            const bilan = bilans.find(b => b.id === id);
            if (!bilan) return;
            
            const date = new Date(bilan.dateCreation).toLocaleDateString('fr-FR');
            let html = `<h2 style="font-size: 32px; margin-bottom: 30px; color: #e94560;">Bilan de ${bilan.nom}</h2>`;
            
            // √âtat Civil
            html += `<div class="detail-section"><h3>√âtat Civil</h3>`;
            html += `<div class="detail-field"><div class="detail-label">Nom</div><div class="detail-value">${bilan.nom}</div></div>`;
            html += `<div class="detail-field"><div class="detail-label">Date</div><div class="detail-value">${date}</div></div>`;
            if (bilan.dateNaissance) html += `<div class="detail-field"><div class="detail-label">Date de naissance</div><div class="detail-value">${bilan.dateNaissance}</div></div>`;
            if (bilan.profession) html += `<div class="detail-field"><div class="detail-label">Profession</div><div class="detail-value">${bilan.profession}</div></div>`;
            if (bilan.sport) html += `<div class="detail-field"><div class="detail-label">Sport(s)</div><div class="detail-value">${bilan.sport}</div></div>`;
            if (bilan.tel) html += `<div class="detail-field"><div class="detail-label">T√©l√©phone</div><div class="detail-value">${bilan.tel}</div></div>`;
            html += `</div>`;
            
            // Histoire personnelle et mode de vie
            if (bilan.histoirePerso || bilan.ergonomie || bilan.stress || bilan.sourcesStress) {
                html += `<div class="detail-section"><h3>Histoire Personnelle et Mode de Vie</h3>`;
                if (bilan.histoirePerso) html += `<div class="detail-field"><div class="detail-label">Environnement</div><div class="detail-value">${bilan.histoirePerso}</div></div>`;
                if (bilan.ergonomie) html += `<div class="detail-field"><div class="detail-label">Ergonomie</div><div class="detail-value">${bilan.ergonomie}</div></div>`;
                if (bilan.stress) html += `<div class="detail-field"><div class="detail-label">Niveau de stress</div><div class="detail-value">${bilan.stress}</div></div>`;
                if (bilan.sourcesStress) html += `<div class="detail-field"><div class="detail-label">Sources de stress</div><div class="detail-value">${bilan.sourcesStress}</div></div>`;
                html += `</div>`;
            }
            
            // Observation posturale
            if (bilan.postureGenerale || bilan.troublesStructurels || bilan.marche || bilan.symetries) {
                html += `<div class="detail-section"><h3>Observation Posturale</h3>`;
                if (bilan.postureGenerale) html += `<div class="detail-field"><div class="detail-label">Posture g√©n√©rale</div><div class="detail-value">${bilan.postureGenerale}</div></div>`;
                if (bilan.troublesStructurels) html += `<div class="detail-field"><div class="detail-label">Troubles structurels</div><div class="detail-value">${bilan.troublesStructurels}</div></div>`;
                if (bilan.marche) html += `<div class="detail-field"><div class="detail-label">Analyse marche</div><div class="detail-value">${bilan.marche}</div></div>`;
                if (bilan.symetries) html += `<div class="detail-field"><div class="detail-label">Sym√©tries/Asym√©tries</div><div class="detail-value">${bilan.symetries}</div></div>`;
                html += `</div>`;
            }
            
            if (bilan.plaintes && bilan.plaintes.length > 0) {
                html += '<div class="detail-section"><h3>Plaintes / Motifs de Consultation</h3>';
                bilan.plaintes.forEach((p, i) => {
                    html += `<div class="plainte-detail">`;
                    html += `<strong>${i === 0 ? 'Plainte Principale' : 'Plainte Secondaire #' + i}: ${p.motif}</strong>`;
                    html += `<div style="color: #e94560; margin: 6px 0;">‚ö° Douleur: ${p.eva}/10</div>`;
                    
                    // Affichage d√©taill√© pour la premi√®re plainte (HDM)
                    if (i === 0) {
                        if (p.dateApparition) html += `<div style="color: #b8c1ec; font-size: 13px; margin-top: 8px;"><strong>Date d'apparition:</strong> ${p.dateApparition}</div>`;
                        if (p.circonstances) html += `<div style="color: #b8c1ec; font-size: 13px; margin-top: 4px;"><strong>Circonstances:</strong> ${p.circonstances}</div>`;
                        if (p.evolution) html += `<div style="color: #b8c1ec; font-size: 13px; margin-top: 4px;"><strong>√âvolution:</strong> ${p.evolution}</div>`;
                        if (p.aggravants) html += `<div style="color: #b8c1ec; font-size: 13px; margin-top: 4px;"><strong>Facteurs aggravants:</strong> ${p.aggravants}</div>`;
                        if (p.ameliorants) html += `<div style="color: #b8c1ec; font-size: 13px; margin-top: 4px;"><strong>Facteurs am√©liorants:</strong> ${p.ameliorants}</div>`;
                        if (p.localisation) html += `<div style="color: #b8c1ec; font-size: 13px; margin-top: 4px;"><strong>Localisation:</strong> ${p.localisation}</div>`;
                        
                        // Type de douleur
                        if (p.typeDouleur) {
                            let types = [];
                            if (p.typeDouleur.mecanique) types.push('M√©canique');
                            if (p.typeDouleur.inflammatoire) types.push('Inflammatoire');
                            if (p.typeDouleur.mixte) types.push('Mixte');
                            if (p.typeDouleur.aigue) types.push('Aigu√´');
                            if (p.typeDouleur.chronique) types.push('Chronique');
                            if (types.length > 0) {
                                html += `<div style="color: #b8c1ec; font-size: 13px; margin-top: 4px;"><strong>Type:</strong> ${types.join(', ')}</div>`;
                            }
                        }
                        
                        if (p.examens) html += `<div style="color: #b8c1ec; font-size: 13px; margin-top: 4px;"><strong>Examens:</strong> ${p.examens}</div>`;
                        if (p.traitementsAnterieurs) html += `<div style="color: #b8c1ec; font-size: 13px; margin-top: 4px;"><strong>Traitements ant√©rieurs:</strong> ${p.traitementsAnterieurs}</div>`;
                    } else {
                        // Affichage simple pour les plaintes secondaires
                        if (p.circonstances) html += `<div style="color: #b8c1ec; font-size: 14px; margin-top: 6px;">${p.circonstances}</div>`;
                    }
                    
                    html += `</div>`;
                });
                html += '</div>';
            }
            
            // Ant√©c√©dents
            if (bilan.pathologies || bilan.traumatiques || bilan.chirurgicaux || bilan.medicaments) {
                html += `<div class="detail-section"><h3>Ant√©c√©dents</h3>`;
                if (bilan.pathologies) html += `<div class="detail-field"><div class="detail-label">Pathologies connues</div><div class="detail-value">${bilan.pathologies}</div></div>`;
                if (bilan.traumatiques) html += `<div class="detail-field"><div class="detail-label">Traumatiques</div><div class="detail-value">${bilan.traumatiques}</div></div>`;
                if (bilan.chirurgicaux) html += `<div class="detail-field"><div class="detail-label">Chirurgicaux</div><div class="detail-value">${bilan.chirurgicaux}</div></div>`;
                if (bilan.medicaments) html += `<div class="detail-field"><div class="detail-label">M√©dicaments en cours</div><div class="detail-value">${bilan.medicaments}</div></div>`;
                html += `</div>`;
            }
            
            // Plaintes par syst√®mes
            if (bilan.systemeCephalique || bilan.systemeCardio || bilan.systemeRespiratoire || bilan.systemeDigestif || 
                bilan.systemeTransit || bilan.systemeUro || bilan.systemeGyneco || bilan.systemeSommeil || 
                bilan.systemePsycho || bilan.systemeNeuro || bilan.systemeVasculaire || bilan.systemeAutres) {
                html += `<div class="detail-section"><h3>Plaintes par Syst√®mes</h3>`;
                if (bilan.systemeCephalique) html += `<div class="detail-field"><div class="detail-label">üß† Sph√®re C√©phalique et ORL</div><div class="detail-value">${bilan.systemeCephalique}</div></div>`;
                if (bilan.systemeCardio) html += `<div class="detail-field"><div class="detail-label">‚ù§Ô∏è Syst√®me Cardio-Vasculaire</div><div class="detail-value">${bilan.systemeCardio}</div></div>`;
                if (bilan.systemeRespiratoire) html += `<div class="detail-field"><div class="detail-label">ü´Å Syst√®me Respiratoire</div><div class="detail-value">${bilan.systemeRespiratoire}</div></div>`;
                if (bilan.systemeDigestif) html += `<div class="detail-field"><div class="detail-label">üçΩÔ∏è Syst√®me Digestif</div><div class="detail-value">${bilan.systemeDigestif}</div></div>`;
                if (bilan.systemeTransit) html += `<div class="detail-field"><div class="detail-label">üí© Transit Intestinal</div><div class="detail-value">${bilan.systemeTransit}</div></div>`;
                if (bilan.systemeUro) html += `<div class="detail-field"><div class="detail-label">ü©∫ Syst√®me Uro-G√©nital</div><div class="detail-value">${bilan.systemeUro}</div></div>`;
                if (bilan.systemeGyneco) html += `<div class="detail-field"><div class="detail-label">üå∏ Sph√®re Gyn√©cologique</div><div class="detail-value">${bilan.systemeGyneco}</div></div>`;
                if (bilan.systemeSommeil) html += `<div class="detail-field"><div class="detail-label">üò¥ Troubles du Sommeil</div><div class="detail-value">${bilan.systemeSommeil}</div></div>`;
                if (bilan.systemePsycho) html += `<div class="detail-field"><div class="detail-label">üßò Troubles Psycho-√âmotionnels</div><div class="detail-value">${bilan.systemePsycho}</div></div>`;
                if (bilan.systemeNeuro) html += `<div class="detail-field"><div class="detail-label">‚ö° Troubles Neurologiques</div><div class="detail-value">${bilan.systemeNeuro}</div></div>`;
                if (bilan.systemeVasculaire) html += `<div class="detail-field"><div class="detail-label">ü©∏ Troubles Vasculaires et Lymphatiques</div><div class="detail-value">${bilan.systemeVasculaire}</div></div>`;
                if (bilan.systemeAutres) html += `<div class="detail-field"><div class="detail-label">üå°Ô∏è Autres Troubles</div><div class="detail-value">${bilan.systemeAutres}</div></div>`;
                html += `</div>`;
            }
            
            if (bilan.bilanOsteo) {
                html += '<div class="detail-section"><h3>Bilan Ost√©o-Articulaire</h3>';
                
                // D√©finir les r√©gions
                const regions = [
                    {nom: 'Pieds', mobilite: 'mobilitePieds', lesions: 'lesionsPieds'},
                    {nom: 'Chevilles', mobilite: 'mobiliteChevilles', lesions: 'lesionsChevilles'},
                    {nom: 'Genoux', mobilite: 'mobiliteGenoux', lesions: 'lesionsGenoux'},
                    {nom: 'Hanches', mobilite: 'mobiliteHanches', lesions: 'lesionsHanches'},
                    {nom: 'Bassin', mobilite: 'mobiliteBassin', lesions: 'lesionsBassin'},
                    {nom: 'Lombaires', mobilite: 'mobiliteLombaires', lesions: 'lesionsLombaires'},
                    {nom: 'Dorsales', mobilite: 'mobiliteDorsales', lesions: 'lesionsDorsales'},
                    {nom: 'Cervicales', mobilite: 'mobiliteCervicales', lesions: 'lesionsCervicales'},
                    {nom: 'Mains', mobilite: 'mobiliteMains', lesions: 'lesionsMains'},
                    {nom: 'Poignets', mobilite: 'mobilitePoignets', lesions: 'lesionsPoignets'},
                    {nom: 'Coudes', mobilite: 'mobiliteCoudes', lesions: 'lesionsCoudes'},
                    {nom: '√âpaules', mobilite: 'mobiliteEpaules', lesions: 'lesionsEpaules'},
                    {nom: 'Cr√¢ne', mobilite: 'mobiliteCrane', lesions: 'lesionsCrane'},
                    {nom: 'Thorax', mobilite: 'mobiliteThorax', lesions: 'lesionsThorax'},
                    {nom: 'Abdomen', mobilite: 'mobiliteAbdomen', lesions: 'lesionsAbdomen'}
                ];
                
                regions.forEach(region => {
                    const mob = bilan.bilanOsteo[region.mobilite];
                    const les = bilan.bilanOsteo[region.lesions];
                    
                    if (mob || les) {
                        html += `<div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; margin-bottom: 10px;">`;
                        html += `<strong style="color: #e94560; display: block; margin-bottom: 8px;">${region.nom}</strong>`;
                        
                        if (mob) {
                            html += `<div style="margin-bottom: 6px;"><span style="color: #06d6a0; font-size: 12px; font-weight: 600;">üü¢ MOBILIT√â:</span> <span style="color: #b8c1ec;">${mob}</span></div>`;
                        }
                        
                        if (les) {
                            html += `<div><span style="color: #e94560; font-size: 12px; font-weight: 600;">üî¥ L√âSIONS:</span> <span style="color: #b8c1ec;">${les}</span></div>`;
                        }
                        
                        html += `</div>`;
                    }
                });
                
                html += '</div>';
            }
            
            if (bilan.traitements && bilan.traitements.length > 0) {
                html += '<div class="detail-section"><h3>Traitements</h3>';
                bilan.traitements.forEach(t => {
                    const dateT = new Date(t.date).toLocaleDateString('fr-FR');
                    html += `<div class="traitement-item"><div class="traitement-date">${dateT}</div><div class="traitement-content">${t.description}</div></div>`;
                });
                html += '</div>';
            }
            
            document.getElementById('bilanDetailContent').innerHTML = html;
        }
        
        function shareBilan(id) {
            const bilan = bilans.find(b => b.id === id);
            if (!bilan) return;
            let text = `üìã BILAN: ${bilan.nom}\nüìÖ ${new Date(bilan.dateCreation).toLocaleDateString('fr-FR')}`;
            
            if (navigator.share) {
                navigator.share({ title: 'Bilan', text: text }).catch(() => {});
            } else {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('‚úÖ Copi√© !');
            }
        }
        
        function deleteBilan(id) {
            if (confirm('‚ö†Ô∏è Supprimer ce bilan ?')) {
                bilans = bilans.filter(b => b.id !== id);
                saveToStorage();
                updateBilansList();
                alert('‚úÖ Supprim√©');
            }
        }
        
        function showStatsAlert() {
            if (bilans.length === 0) {
                alert('üìä Aucune statistique');
                return;
            }
            alert(`üìä STATISTIQUES\n\nüìã Total: ${bilans.length} bilan(s)`);
        }
        
        function exportAllBilans() {
            if (bilans.length === 0) {
                alert('Aucune donn√©e');
                return;
            }
            const dataStr = JSON.stringify(bilans, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'osteopro_bilans_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            URL.revokeObjectURL(url);
            alert(`‚úÖ ${bilans.length} bilan(s) export√©(s) !`);
        }
        
        init();
    </script>
</body>
</html>
